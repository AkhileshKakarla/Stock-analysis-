// backend/routes/ticker.js
const express = require("express");
const axios = require("axios");
const router = express.Router();

router.get("/", async (req, res) => {
  try {
    const tickers = ["RELIANCE", "TCS", "INFY", "USDINR", "NIFTY"];
    const results = await Promise.all(
      tickers.map(tkr =>
        axios.get(`https://api.polygon.io/v2/aggs/ticker/${tkr}/prev`, {
          params: { apiKey: process.env.POLYGON_KEY }
        })
      )
    );
    const stockData = results.map((r, i) => ({
      ticker: tickers[i],
      name: tickers[i],
      price: r.data.results[0].c,
      change: ((r.data.results[0].c - r.data.results[0].o) / r.data.results[0].o * 100).toFixed(2),
      logoUrl: `/assets/${tickers[i]}.png`
    }));
    res.json(stockData);
  } catch (err) {
    res.status(500).json({ error: "Failed fetching real-time data" });
  }
});

module.exports = router;
